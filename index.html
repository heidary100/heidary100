<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform Documentation: Universal Character Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Very light background */
            color: #1f2937; /* Dark text for high contrast */
            font-weight: 300; /* Default body text is light */
        }
        h1, h2 {
            font-weight: 200; /* Extra light for main headers */
            color: #111827; /* Near black for emphasis */
        }
        .nav-link {
            transition: color 0.3s ease, border-bottom 0.3s ease;
            color: #4b5563; /* Subtle gray */
            font-weight: 400;
        }
        .nav-link:hover {
            color: #3b82f6; /* Accent Blue */
            border-bottom: 1px solid #3b82f6;
        }
        .card-light {
            background-color: #ffffff;
            border: 1px solid #e5e7eb; /* Thin, light gray border */
            transition: all 0.3s ease;
        }
        .card-light:hover {
            border-color: #3b82f6; /* Subtle blue border on hover */
        }
        .module-btn {
            font-weight: 400;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
            border: 1px solid #d1d5db; /* Light border */
            background-color: #f3f4f6;
            color: #4b5563;
        }
        .module-btn.active {
            background-color: #3b82f6; /* Accent Blue */
            color: #ffffff;
            border-color: #3b82f6;
            font-weight: 600;
        }
        .timeline-btn.active {
            background-color: #10b981; /* Accent Green */
            color: #ffffff;
            font-weight: 600;
        }
    </style>
</head>
<body class="font-light">

    <!-- START MAIN SELECTION SCREEN -->
    <div id="selection-screen" class="fixed inset-0 bg-gray-50 flex flex-col items-center justify-center z-50 transition-opacity duration-500">
        <h1 class="text-7xl font-extralight text-gray-900 mb-6 tracking-tight">
            Universal <span class="text-indigo-600">Character Platform</span>
        </h1>
        <p class="text-xl text-gray-500 mb-12 font-light">
            Select the domain you are interested in exploring.
        </p>
        <div class="flex space-x-8">
            <button id="show-business" class="px-12 py-6 text-xl font-light rounded-xl bg-indigo-600 text-white border-b-4 border-indigo-800 hover:bg-indigo-700 transition transform hover:scale-[1.03]">
                Business & Academic Vision
            </button>
            <button id="show-technical" class="px-12 py-6 text-xl font-light rounded-xl bg-green-500 text-white border-b-4 border-green-700 hover:bg-green-600 transition transform hover:scale-[1.03]">
                Technical Deep Dive
            </button>
        </div>
    </div>
    <!-- END MAIN SELECTION SCREEN -->

    <!-- NAVIGATION -->
    <header id="main-header" class="bg-white/95 backdrop-blur-sm sticky top-0 z-40 border-b border-gray-200 hidden">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="text-3xl font-extralight text-gray-900 tracking-widest">Platform <span class="text-indigo-600">Docs</span></span>
                    </div>
                </div>
                <!-- Navigation links -->
                <div id="nav-links" class="hidden md:block space-x-6">
                    <!-- Links inserted here by JS -->
                </div>
                <button id="back-to-selection" class="px-5 py-2 text-sm font-light rounded-full bg-white text-gray-700 border border-gray-300 hover:bg-gray-100 transition">
                    Change View
                </button>
            </div>
        </nav>
    </header>
    <!-- END NAVIGATION -->

    <main class="min-h-screen">

        <!-- START TECHNICAL VIEW CONTENT -->
        <div id="technical-view" class="hidden">
            <section id="architecture" class="bg-gray-50">
                <div class="max-w-7xl mx-auto py-24 px-4 sm:px-6 lg:px-8 text-center">
                    <p class="text-sm font-medium text-indigo-600 uppercase tracking-widest mb-2">
                        Developer & Engineering Track
                    </p>
                    <h1 class="mt-2 text-6xl font-extralight">
                        Architecture & Protocol
                    </h1>
                    <p class="mt-8 max-w-4xl mx-auto text-lg text-gray-600 font-light">
                        This architecture provides a scalable, extensible foundation for interactive storytelling and agentic systems, built from a single codebase accessible via VR, desktop, and mobile.
                    </p>
                    <div class="mt-14 grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto text-left">
                        <div class="p-6 card-light rounded-xl">
                            <h3 class="font-normal text-xl text-gray-800">Target Platforms</h3>
                            <p class="text-sm text-gray-500 mt-3">Meta Quest (VR), Desktop (Win/Mac), Mobile (iOS/Android). **Single code base** targeting multiple distribution channels.</p>
                        </div>
                        <div class="p-6 card-light rounded-xl">
                            <h3 class="font-normal text-xl text-gray-800">Core Languages</h3>
                            <p class="text-sm text-gray-500 mt-3">**C#** (Unity Engine for client logic), **Node.js** with **TypeScript** for the stateful, command-based backend orchestrator.</p>
                        </div>
                        <div class="p-6 card-light rounded-xl">
                            <h3 class="font-normal text-xl text-gray-800">Communication Protocol</h3>
                            <p class="text-sm text-gray-500 mt-3">**REST API** for state initialization and major transactions. **WebSocket** for low-latency, real-time command streaming (dialogue, motion).</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="modules" class="py-24 px-4 sm:px-6 lg:px-8">
                <div class="max-w-7xl mx-auto">
                    <div class="text-center">
                        <h2 class="text-5xl font-extralight">Decoupled Module Functions</h2>
                        <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600 font-light">
                            A strict separation ensures the Frontend is a rendering layer and the Backend holds all business and character logic.
                        </p>
                    </div>
                    
                    <div class="mt-16 card-light p-8 rounded-2xl">
                        <div class="flex justify-center space-x-6 mb-10">
                            <button data-module="frontend" class="module-btn active px-8 py-4 text-sm rounded-full uppercase tracking-wider">Frontend Client (C#)</button>
                            <button data-module="backend" class="module-btn px-8 py-4 text-sm rounded-full uppercase tracking-wider hover:bg-gray-200">Backend Orchestrator (Node/TS)</button>
                        </div>

                        <div id="module-display" class="grid gap-6 md:grid-cols-2">
                            <!-- Content injected here by JS -->
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="tech-milestones" class="bg-gray-50 py-24 px-4 sm:px-6 lg:px-8">
                <div class="max-w-7xl mx-auto">
                    <div class="text-center">
                        <h2 class="text-5xl font-extralight">Development Milestones</h2>
                        <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600 font-light">
                            High-level plan showing dependencies and key integration points for the platform launch.
                        </p>
                    </div>

                    <div class="mt-12 flex justify-center space-x-6" id="technical-timeline-controls">
                        <button data-phase="1" class="timeline-btn active px-8 py-3 text-sm font-medium rounded-lg border-b-2 border-green-700 transition">Phase 1: Foundation</button>
                        <button data-phase="2" class="timeline-btn px-8 py-3 text-sm font-medium rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 transition">Phase 2: Integration</button>
                        <button data-phase="3" class="timeline-btn px-8 py-3 text-sm font-medium rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 transition">Phase 3: Expansion</button>
                    </div>
                    
                    <div class="mt-12 grid grid-cols-1 lg:grid-cols-5 gap-12 items-center">
                        <div class="lg:col-span-3">
                            <div class="chart-container relative w-full h-56 md:h-72 max-w-3xl mx-auto p-4 bg-white border border-gray-200 rounded-xl">
                                <canvas id="roadmapChart"></canvas>
                            </div>
                        </div>
                        <div id="technical-timeline-details" class="lg:col-span-2 card-light p-8 rounded-xl">
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <!-- END TECHNICAL VIEW CONTENT -->


        <!-- START BUSINESS/ACADEMIC VIEW CONTENT -->
        <div id="business-view" class="hidden">
            <section id="vision" class="bg-gray-50">
                <div class="max-w-7xl mx-auto py-24 px-4 sm:px-6 lg:px-8 text-center">
                    <p class="text-sm font-medium text-indigo-600 uppercase tracking-widest mb-2">
                        INVESTOR & ACADEMIC SUMMARY
                    </p>
                    <h1 class="mt-2 text-6xl font-extralight">
                        Interactive Clinical Training
                    </h1>
                    <p class="mt-8 max-w-4xl mx-auto text-lg text-gray-600 font-light">
                        The Universal Character Platform is a disruptive solution addressing critical limitations in contemporary clinical education and digital therapy.
                    </p>
                    <div class="mt-14 grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto text-left">
                        <div class="p-6 card-light rounded-xl">
                            <h3 class="font-normal text-xl text-gray-800">The Core Problem</h3>
                            <p class="text-sm text-gray-500 mt-3">Static, script-based simulations fail to build deep empathy and critical clinical communication skills required for emergent patient interactions.</p>
                        </div>
                        <div class="p-6 card-light rounded-xl">
                            <h3 class="font-normal text-xl text-gray-800">The Differentiator</h3>
                            <p class="text-sm text-gray-500 mt-3">Real-time, emotionally responsive 3D characters driven by generative AI provide truly emergent, non-scripted, high-stakes interactions.</p>
                        </div>
                        <div class="p-6 card-light rounded-xl">
                            <h3 class="font-normal text-xl text-gray-800">Targeted Impact</h3>
                            <p class="text-sm text-gray-500 mt-3">Scalable, low-cost training that significantly improves diagnostic accuracy and empathetic communication outcomes for clinicians globally.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="roi" class="py-24 px-4 sm:px-6 lg:px-8">
                <div class="max-w-7xl mx-auto">
                    <div class="text-center">
                        <h2 class="text-5xl font-extralight">Value Proposition & Market Opportunity</h2>
                        <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600 font-light">
                            Our unique architecture translates into quantifiable financial and academic advantages over existing market solutions.
                        </p>
                    </div>
                    
                    <div class="mt-16 grid gap-6 lg:grid-cols-3">
                        <div class="card-light p-8 rounded-xl border-t-4 border-indigo-500">
                            <h4 class="font-medium text-xl text-indigo-600">Financial ROI</h4>
                            <p class="mt-3 text-sm text-gray-700 font-light">
                                Shifts high-cost physical simulation ($50k+ per facility) to a low-latency, high-throughput **subscription model**, eliminating physical upkeep.
                            </p>
                        </div>
                         <div class="card-light p-8 rounded-xl border-t-4 border-indigo-500">
                            <h4 class="font-medium text-xl text-indigo-600">Market Potential</h4>
                            <p class="mt-3 text-sm text-gray-700 font-light">
                                Rapid content velocity (new scenarios via logic layer) unlocks global accessibility and a significant share of the **$8B** healthcare education market.
                            </p>
                        </div>
                         <div class="card-light p-8 rounded-xl border-t-4 border-indigo-500">
                            <h4 class="font-medium text-xl text-indigo-600">Academic Impact</h4>
                            <p class="mt-3 text-sm text-gray-700 font-light">
                                Provides rich, standardized data logs (verbal, non-verbal, emotion) for **unparalleled research validity** in human-AI interaction studies.
                            </p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <!-- END BUSINESS/ACADEMIC VIEW CONTENT -->

        <!-- START INTERACTIVE LLM DEMO SECTION (NEW) -->
        <section id="interactive-demo" class="py-24 px-4 sm:px-6 lg:px-8 bg-gray-50">
            <div class="max-w-7xl mx-auto">
                <div class="text-center">
                    <h2 class="text-5xl font-extralight">Interactive LLM Demo</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600 font-light">
                        Demonstrate the **Generative AI** and **Google Search Grounding** that powers the core Character Dialogue Engine.
                    </p>
                </div>
                 
                <div class="mt-12 w-full max-w-4xl mx-auto bg-white border border-gray-200 rounded-xl">
                    <header class="p-6 border-b border-gray-200">
                        <h3 class="text-xl font-medium text-gray-800">Character Query Tool</h3>
                        <p class="mt-1 text-gray-500 text-sm">Ask a question to test real-time data retrieval.</p>
                    </header>

                    <!-- LLM Demo Content -->
                    <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-6">

                        <!-- Input Column -->
                        <div class="flex flex-col space-y-4">
                            <h4 class="text-base font-semibold text-gray-700">Enter Query</h4>
                            
                            <textarea id="prompt-input"
                                      rows="6"
                                      placeholder="Example: 'What were the latest findings on personalized medicine trials?'"
                                      class="p-3 w-full text-sm border border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 resize-none outline-none"></textarea>
                            
                            <button id="generate-button"
                                    class="px-4 py-2 text-white font-medium bg-indigo-600 rounded-lg hover:bg-indigo-700 transition border-b-4 border-indigo-800 active:border-b-0 disabled:bg-indigo-300">
                                Send to AI Engine
                            </button>
                        </div>

                        <!-- Output Column -->
                        <div class="flex flex-col space-y-4">
                            <h4 class="text-base font-semibold text-gray-700">Generated Response</h4>

                            <div id="output-area"
                                 class="min-h-[150px] p-3 bg-white border border-gray-300 rounded-lg text-gray-800 text-sm overflow-auto whitespace-pre-wrap">
                                Response and grounding sources will appear here.
                            </div>

                            <div id="loading-spinner" class="hidden text-center">
                                <div class="inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] text-indigo-500 motion-reduce:animate-[spin_1.5s_linear_infinite]"
                                     role="status">
                                    <span class="!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]">Loading...</span>
                                </div>
                                <p class="text-sm text-gray-500 mt-2">Connecting to Orchestrator...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- END INTERACTIVE LLM DEMO SECTION -->


        <!-- SHARED SECTION: COMPETITIVE ANALYSIS -->
        <section id="competitive-analysis" class="py-24 px-4 sm:px-6 lg:px-8">
            <div class="max-w-7xl mx-auto">
                <div class="text-center">
                    <h2 class="text-5xl font-extralight">Competitive Landscape</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600 font-light">
                        Our position relative to established clinical simulation and digital health solutions.
                    </p>
                </div>

                <div class="mt-16 grid gap-6 lg:grid-cols-2">
                    <!-- Competitor 1: Clinical VR/HoloLens Simulation Platforms -->
                    <div class="card-light p-8 rounded-2xl border border-gray-300">
                        <h3 class="text-3xl font-light text-red-600 mb-4">Clinical Simulation Platforms</h3>
                        <div class="grid grid-cols-2 gap-4 text-xs">
                            <div class="p-4 bg-gray-50 rounded-lg border border-green-500/50">
                                <h4 class="font-medium text-green-600 mb-1">Pros (+)</h4>
                                <ul class="mt-1 space-y-1 font-light list-disc pl-4 text-gray-600">
                                    <li>High procedural fidelity.</li>
                                </ul>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-lg border border-red-500/50">
                                <h4 class="font-medium text-red-600 mb-1">Cons (-)</h4>
                                <ul class="mt-1 space-y-1 font-light list-disc pl-4 text-gray-600">
                                    <li>**Static Content.**</li>
                                    <li>Very **High Cost** and low scalability.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Competitor 2: Pure Conversational AI / Text-Based Therapy Apps -->
                    <div class="card-light p-8 rounded-2xl border border-gray-300">
                        <h3 class="text-3xl font-light text-red-600 mb-4">Conversational AI & Health Bots</h3>
                        <div class="grid grid-cols-2 gap-4 text-xs">
                            <div class="p-4 bg-gray-50 rounded-lg border border-green-500/50">
                                <h4 class="font-medium text-green-600 mb-1">Pros (+)</h4>
                                <ul class="mt-1 space-y-1 font-light list-disc pl-4 text-gray-600">
                                    <li>High accessibility (mobile).</li>
                                </ul>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-lg border border-red-500/50">
                                <h4 class="font-medium text-red-600 mb-1">Cons (-)</h4>
                                <ul class="mt-1 space-y-1 font-light list-disc pl-4 text-gray-600">
                                    <li>**Low Empathy:** Lacks non-verbal cues.</li>
                                    <li>Cannot simulate **immersive scenarios**.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- END SHARED SECTION -->

        <footer class="mt-16 border-t border-gray-200 p-10 text-center text-sm font-light text-gray-400">
            Platform Document Version 3.0 &bull; Minimal Light Theme &bull; Demo Integrated.
        </footer>
    </main>
    
    <script type="module">
        // --- VIEW MANAGEMENT LOGIC ---
        const selectionScreen = document.getElementById('selection-screen');
        const technicalView = document.getElementById('technical-view');
        const businessView = document.getElementById('business-view');
        const mainHeader = document.getElementById('main-header');
        const navLinksContainer = document.getElementById('nav-links');

        const technicalLinks = `
            <a href="#architecture" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Architecture</a>
            <a href="#modules" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Core Modules</a>
            <a href="#tech-milestones" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Milestones</a>
            <a href="#interactive-demo" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-indigo-600 border-b border-indigo-200">AI Demo</a>
            <a href="#competitive-analysis" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Competition</a>
        `;
        
        const businessLinks = `
            <a href="#vision" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Clinical Vision</a>
            <a href="#roi" class="nav-link px-3 py-2 rounded-md text-sm font-medium">ROI & Market</a>
            <a href="#interactive-demo" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-indigo-600 border-b border-indigo-200">AI Demo</a>
            <a href="#competitive-analysis" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Competition</a>
        `;

        function showView(viewId, links) {
            selectionScreen.classList.add('opacity-0');
            setTimeout(() => {
                selectionScreen.classList.add('hidden');
            }, 500); 
            
            technicalView.classList.add('hidden');
            businessView.classList.add('hidden');
            
            if (viewId === 'technical') {
                technicalView.classList.remove('hidden');
                // Initialize chart and modules for technical view only if showing technical view
                if (!window.roadmapChart) {
                    createRoadmapChart();
                    updateTimeline('1');
                }
                updateModuleDisplay('frontend');

            } else if (viewId === 'business') {
                businessView.classList.remove('hidden');
            }
            
            mainHeader.classList.remove('hidden');
            navLinksContainer.classList.remove('hidden');
            navLinksContainer.innerHTML = links;
        }

        document.getElementById('show-technical').addEventListener('click', () => {
            showView('technical', technicalLinks);
        });

        document.getElementById('show-business').addEventListener('click', () => {
            showView('business', businessLinks);
        });

        document.getElementById('back-to-selection').addEventListener('click', () => {
            technicalView.classList.add('hidden');
            businessView.classList.add('hidden');
            mainHeader.classList.add('hidden');
            navLinksContainer.classList.add('hidden');
            selectionScreen.classList.remove('hidden');
            setTimeout(() => {
                 selectionScreen.classList.remove('opacity-0');
            }, 10);
        });


        // --- TECHNICAL VIEW SPECIFIC LOGIC (Modules, Chart, Timeline) ---
        
        const moduleData = {
            frontend: {
                title: "Unity Client Responsibilities",
                description: "The client (Unity) focuses entirely on immersive rendering, user interaction, and data visualization. It is a 'dumb terminal' driven by commands from the Orchestrator.",
                list: [
                    "Rendering: Character animation state machine, environment rendering.",
                    "XR: Input handling and locomotion via Meta XR SDK.",
                    "Audio: Dynamic playback of TTS audio streams received from the backend.",
                    "Networking: Maintaining persistent WebSocket and ephemeral REST connections."
                ],
                code: "// Input from Orchestrator\n{\"command\": \"MoveTo\", \"target\": \"center_point\"}\n// Output to Orchestrator\n{\"type\": \"user_voice_data\", \"stream_id\": \"mic_001\"}"
            },
            backend: {
                title: "Node Orchestrator Responsibilities",
                description: "The backend is the brain, managing all complex character logic, state, dialogue flow, and external API routing. Single source of truth for character state.",
                list: [
                    "Character State: Manages position, focus, emotional state, and active behaviors.",
                    "API Gateway: Proxies requests to LLMs and TTS services.",
                    "Command Generation: Translates high-level intent (e.g., 'explain X') into low-level Unity commands.",
                    "Transport Layer: Manages the REST/WebSocket bridge for communication."
                ],
                code: "// Input from Client\n{\"type\": \"user_input\", \"text\": \"How are you?\"}\n// Output from Orchestrator\n{\"command\": \"SetEmotion\", \"emotion\": \"curious\", \"duration\": 3.5}"
            }
        };
        
        const moduleButtonsContainer = document.getElementById('modules')?.querySelector('.flex');
        const moduleDisplay = document.getElementById('module-display');

        function updateModuleDisplay(moduleKey) {
            if (!moduleDisplay || !moduleButtonsContainer) return;

            const data = moduleData[moduleKey];
            const moduleBtns = moduleButtonsContainer.querySelectorAll('.module-btn');
            
            moduleBtns.forEach(btn => {
                btn.classList.remove('active', 'bg-indigo-600', 'text-white', 'border-indigo-600', 'font-semibold');
                btn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            });
            
            const activeBtn = moduleButtonsContainer.querySelector(`[data-module="${moduleKey}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'bg-indigo-600', 'text-white', 'border-indigo-600', 'font-semibold');
                activeBtn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            }

            moduleDisplay.innerHTML = `
                <div class="p-6 bg-gray-50 rounded-xl border border-gray-200">
                    <h3 class="text-2xl font-normal text-indigo-600">${data.title}</h3>
                    <p class="mt-2 text-sm text-gray-600 font-light">
                        ${data.description}
                    </p>
                    <ul class="mt-4 space-y-2 text-gray-700 text-sm list-disc pl-5 font-light">
                        ${data.list.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>
                <div class="p-6 bg-gray-50 rounded-xl border border-gray-200">
                    <h3 class="text-2xl font-normal text-indigo-600">Communication Reference</h3>
                    <p class="mt-2 text-sm text-gray-600 font-light">
                        Example I/O packets handled by the ${moduleKey} module via WebSocket.
                    </p>
                    <div class="mt-4 p-4 bg-gray-900 rounded-md text-xs font-mono text-green-300 whitespace-pre-line border border-gray-700">
                        ${data.code}
                    </div>
                </div>
            `;
        }

        if (moduleButtonsContainer) {
             moduleButtonsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('module-btn')) {
                    updateModuleDisplay(e.target.dataset.module);
                }
            });
        }


        const timelineData = {
            1: {
                phase: "Phase 1: Foundation (Weeks 1-4)",
                focus: "Monorepo Setup & Core Comm.",
                deliverables: [
                    "Unity project setup & XR SDK integration",
                    "Implement programmatic locomotion (C#)",
                    "Node/TS Orchestrator scaffold with REST/WS bridge",
                    "Stubbed speech system with mock endpoints"
                ],
                completion: "Initial Comm. Layer Functional"
            },
            2: {
                phase: "Phase 2: AI & Cross-Platform (Weeks 5-8)",
                focus: "LLM, TTS, & Deployment Integration",
                deliverables: [
                    "Integrate OpenAI LLM for text generation via proxy API",
                    "Integrate ElevenLabs for dynamic TTS streaming",
                    "Implement C# client handling for full command packets",
                    "Generate Desktop and Mobile cross-platform builds"
                ],
                completion: "Fully Interactive Prototype"
            },
            3: {
                phase: "Phase 3: Optimization & Extensibility (Weeks 9-12)",
                focus: "Performance, Cloud, & Feature API",
                deliverables: [
                    "Implement Expression/Gesture APIs in Orchestrator and Client",
                    "Cloud deployment (Containerized) for Orchestrator services",
                    "Performance optimization for Meta Quest HMD target",
                    "Finalizing internal documentation and code review"
                ],
                completion: "Production-Ready Platform V1"
            }
        };
        
        const timelineControls = document.getElementById('technical-timeline-controls');
        const timelineDetails = document.getElementById('technical-timeline-details');
        
        function updateTimeline(phaseId) {
            if (!timelineDetails || !timelineControls) return;

            const data = timelineData[phaseId];
            timelineDetails.innerHTML = `
                <h3 class="text-2xl font-normal text-gray-800">${data.phase}</h3>
                <p class="mt-2 text-base font-light text-green-600">${data.focus}</p>
                <ul class="mt-6 space-y-3 text-gray-700 text-sm list-disc pl-5 font-light">
                    ${data.deliverables.map(item => `<li>${item}</li>`).join('')}
                </ul>
                <p class="mt-6 text-xs text-gray-500 font-normal border-t border-gray-200 pt-4">STATUS TARGET: ${data.completion}</p>
            `;
            
            const timelineBtns = timelineControls.querySelectorAll('.timeline-btn');
            timelineBtns.forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                btn.classList.remove('border-green-700');
            });
            const activeBtn = timelineControls.querySelector(`[data-phase="${phaseId}"]`);
            if (activeBtn) {
                 activeBtn.classList.add('active', 'bg-green-500', 'text-white', 'border-green-700');
                 activeBtn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            }
           
            updateChartHighlight(phaseId);
        }

        if (timelineControls) {
             timelineControls.addEventListener('click', (e) => {
                if(e.target.classList.contains('timeline-btn')) {
                    updateTimeline(e.target.dataset.phase);
                }
            });
        }

        function createRoadmapChart() {
            const ctx = document.getElementById('roadmapChart').getContext('2d');
            window.roadmapChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Phase 3', 'Phase 2', 'Phase 1'],
                    datasets: [{
                        label: 'Duration (Weeks)',
                        data: [
                            {x: [8, 12], y: 'Phase 3'},
                            {x: [4, 8], y: 'Phase 2'},
                            {x: [0, 4], y: 'Phase 1'}
                        ],
                        backgroundColor: ['#d1d5db', '#d1d5db', '#10b981'],
                        borderColor: '#ffffff',
                        borderWidth: 2,
                        barPercentage: 0.6,
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            min: 0,
                            max: 12,
                            title: {
                                display: true,
                                text: 'Timeline in Weeks',
                                color: '#6b7280',
                                font: { family: 'Inter', weight: '300'}
                            },
                            grid: {
                                display: false,
                                color: '#e5e7eb'
                            },
                            ticks: {
                                stepSize: 2,
                                color: '#6b7280',
                                font: { family: 'Inter', weight: '300'}
                            }
                        },
                        y: {
                            grid: {
                                display: true,
                                color: '#e5e7eb'
                            },
                            ticks: {
                                color: '#6b7280',
                                font: { family: 'Inter', weight: '300'}
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: true,
                            bodyColor: '#ffffff',
                            titleColor: '#ffffff',
                            backgroundColor: '#3b82f6',
                            callbacks: {
                                 title: function(context) {
                                     return context[0].label;
                                 },
                                 label: function(context) {
                                     return 'Duration: 4 Weeks';
                                 }
                            }
                        }
                    }
                }
            });
        }
        
        function updateChartHighlight(phaseId) {
            if (!window.roadmapChart) return;

            const activeColor = '#10b981'; // Green
            const inactiveColor = '#d1d5db'; // Light Gray
            const newColors = window.roadmapChart.data.datasets[0].data.map((item, index) => {
                const currentPhase = 3 - index;
                return currentPhase == phaseId ? activeColor : inactiveColor;
            });
            window.roadmapChart.data.datasets[0].backgroundColor = newColors;
            window.roadmapChart.update();
        }

        // --- INTERACTIVE LLM DEMO LOGIC ---
        // Elements are available in the DOM after the view switch
        let promptInput, generateButton, outputArea, loadingSpinner;

        // Initialize demo elements once they are in the DOM (after first view switch)
        function initializeDemoElements() {
             promptInput = document.getElementById('prompt-input');
             generateButton = document.getElementById('generate-button');
             outputArea = document.getElementById('output-area');
             loadingSpinner = document.getElementById('loading-spinner');
             
             if (generateButton && !generateButton._listenerAdded) {
                 generateButton.addEventListener('click', generateContent);
                 generateButton._listenerAdded = true; // Prevents re-adding
             }
             if (promptInput && !promptInput._listenerAdded) {
                promptInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        generateContent();
                    }
                });
                promptInput._listenerAdded = true;
             }
        }

        // Override showView to initialize demo elements after content is loaded
        const originalShowView = showView;
        showView = function(viewId, links) {
            originalShowView(viewId, links);
            // Wait for the DOM to be updated before initializing LLM elements
            setTimeout(initializeDemoElements, 0); 
        };

        // LLM API functions
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        async function fetchWithRetry(url, options, maxRetries = 5, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) {
                        return response;
                    }
                    if (response.status === 429 && i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; 
                    } else {
                        throw new Error(`API request failed with status: ${response.status}`);
                    }
                } catch (error) {
                    if (i === maxRetries - 1) {
                        throw error;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2; 
                }
            }
            throw new Error("API request failed after multiple retries.");
        }

        async function generateContent() {
            const userQuery = promptInput.value.trim();
            if (!userQuery) {
                outputArea.textContent = "Please enter a query before generating content.";
                return;
            }

            // Show loading state
            generateButton.disabled = true;
            loadingSpinner.classList.remove('hidden');
            outputArea.textContent = '';

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                // Using Google Search grounding for real-time information
                tools: [{ "google_search": {} }],
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                const response = await fetchWithRetry(apiUrl, options);
                const result = await response.json();
                
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;

                    // Extract grounding sources
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    // Display the generated text
                    let fullText = text;
                    
                    // Append sources if available
                    if (sources.length > 0) {
                        fullText += "\n\n---\n\n";
                        fullText += "Source Grounding:\n";
                        sources.forEach((source, index) => {
                            fullText += `${index + 1}. ${source.title} (${source.uri})\n`;
                        });
                    }
                    
                    outputArea.textContent = fullText;

                } else {
                    outputArea.textContent = "Error: Could not retrieve a valid response from the model.";
                    console.error("Model response structure invalid:", result);
                }

            } catch (error) {
                outputArea.textContent = `An error occurred: ${error.message}. Please try again.`;
                console.error("Generation error:", error);
            } finally {
                // Hide loading state
                generateButton.disabled = false;
                loadingSpinner.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Initial setup runs once
            // The chart is created only if the technical view is chosen
        });
    </script>
</body>
</html>
